# Coverage Baseline Workflow Setup

## Problem

The `clearlyip/code-coverage-report-action` in `.github/workflows/test.yml` needs a baseline coverage report from the `main` branch to compare PRs against. Without this baseline, it cannot calculate coverage differences.

## Solution

This workflow (`coverage-baseline.yml`) runs on every push to `main` and generates the baseline coverage report that PRs will compare against.

## Installation Steps

1. **Copy the workflow file to the workflows directory:**
   ```bash
   cp workflows-to-add/coverage-baseline.yml .github/workflows/coverage-baseline.yml
   ```

2. **Commit and push the new workflow:**
   ```bash
   git add .github/workflows/coverage-baseline.yml
   git commit -m "feat: add coverage baseline workflow for main branch"
   git push origin main
   ```

3. **Generate the initial baseline:**

   After the workflow is merged to `main`, it will run automatically. However, you can also trigger it manually:
   - Go to: https://github.com/njdancer/second-brain/actions/workflows/coverage-baseline.yml
   - Click "Run workflow"
   - Select the `main` branch
   - Click "Run workflow"

4. **Verify it works:**

   After the baseline workflow completes, create a test PR with a code change and verify that:
   - The test workflow runs successfully
   - The coverage comparison shows up in the PR comments
   - No errors about missing baseline data

## How It Works

1. **Main branch pushes:**
   - `coverage-baseline.yml` runs on main
   - Generates coverage report
   - Uploads it using the coverage action (creates artifact/stores data)

2. **PR builds:**
   - `.github/workflows/test.yml` runs on PRs
   - The coverage action automatically downloads the baseline from main
   - Compares PR coverage against baseline
   - Posts a comment showing the diff

## Cleanup

After installation is complete and verified working, you can delete this directory:
```bash
rm -rf workflows-to-add/
git add workflows-to-add/
git commit -m "chore: remove workflow setup instructions"
```

## Troubleshooting

**If PRs still can't find the baseline:**
1. Check that the baseline workflow ran successfully on main
2. Verify it uploaded the coverage report (check workflow logs)
3. Try manually triggering the baseline workflow
4. Check that both workflows use the same version of `clearlyip/code-coverage-report-action`

**If you see "No coverage data found":**
- Make sure `coverage/clover.xml` is being generated by tests
- Check that the `filename` parameter matches in both workflows
- Verify tests are actually running (check for test output in logs)
